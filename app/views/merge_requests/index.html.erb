<script>
  var link = document.querySelector("link[rel~='icon']");
  if (!link) {
    link = document.createElement('link');
    link.rel = 'icon';
    document.head.appendChild(link);
  }
  link.href = "<%= make_full_url(@user.avatarUrl) %>";
</script>

<script
  src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"
  integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB"
  crossorigin="anonymous"
></script>
<script
  src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"
  integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13"
  crossorigin="anonymous"
></script>

<div class="container-fluid" style="margin:0 !important; padding:0 !important;">
  <nav class="navbar navbar-light bg-dark">
    <span class="navbar-brand mb-0 ms-2 h1 text-light">
      Merge Requests Dashboard for
      <%= render "user_image", user: @user, size: 24 %>
      <%= link_to @user.username, @user.webUrl %>
    </span>
  </nav>

  <%= turbo_frame_tag "merge_requests", src: "/mrs/#{params[:assignee]}/list" do %>
    <%= tag.div(style: "background-color: rgba(0, 0, 0, 0.6);",
      class: %w[position-absolute w-100 h-100 d-flex justify-content-center align-items-center]) do %>
      <div class="spinner-border text-light" role="status" aria-hidden="true"></div>
      &nbsp;
      <div class="text-light">Loading merge requestsâ€¦
        <% if @updated_at %>
          (Last fetched
          <%= render("relative_timestamp", timestamp: @updated_at) %>)
        <% end %>
      </div>
    <% end %>

    <% if @updated_at %>
      <!-- Show last stored state, while we wait for the refreshed state -->
      <div class="table-responsive-sm">
        <%= render "open_merge_requests", merge_requests: @open_merge_requests %>

        <hr/>

        <%= render "merged_merge_requests", merge_requests: @merged_merge_requests %>
      </div>
    <% end %>
  <% end %>
</div>
